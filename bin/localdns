#!/usr/bin/env python

import os
import sys
import json
import argparse
import socket
import fcntl
import struct
import urllib2

parser = argparse.ArgumentParser(prog = 'localdns')
parser.add_argument('--conf', '-c', required=True)
OPTS = parser.parse_args()

CONF = json.loads(open(OPTS.conf).read())

def get_ip(ifname):
    ifname = str(ifname)
    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    return socket.inet_ntoa(fcntl.ioctl(
        s.fileno(),
        0x8915,  # SIOCGIFADDR
        struct.pack('256s', ifname[:15])
    )[20:24])

print CONF
print get_ip(CONF['iface'])
